/**
 * Diccionario móvil para i18n.
 * Claves compartidas: sidebar (navegación), settings (Ajustes).
 * Fallback: es
 */
export const translations = {
  es: {
    sidebar: {
      appName: "Digital Brain",
      factory: "Fábrica de ideas",
      processed: "Procesado",
      calendar: "Calendario",
      settings: "Ajustes",
    },
    settings: {
      title: "Ajustes",
      darkMode: "Modo Oscuro",
      reviewSuggestions: "Sugerencias de revisión",
      dataPrivacy: "Datos y privacidad",
      exportNotes: "Exportar mis notas",
      cloudBackup: "Copia de seguridad en la nube",
      freeSpace: "Liberar espacio",
      ai: "Inteligencia Artificial",
      assistLevel: "Nivel de asistencia de la IA",
      summaryLanguage: "Idioma de los resúmenes",
      supportAccount: "Soporte y cuenta",
      editProfile: "Editar perfil",
      helpCenter: "Centro de ayuda",
      logout: "Cerrar sesión",
      summaryLanguageTitle: "Idioma de los resúmenes",
      selected: "Seleccionado",
    },
    languages: {
      es: "Español",
      en: "English",
      fr: "Français",
      pt: "Português",
      it: "Italiano",
      de: "Deutsch",
    },
  },
  en: {
    sidebar: {
      appName: "Digital Brain",
      factory: "Idea factory",
      processed: "Processed",
      calendar: "Calendar",
      settings: "Settings",
    },
    settings: {
      title: "Settings",
      darkMode: "Dark mode",
      reviewSuggestions: "Review suggestions",
      dataPrivacy: "Data and privacy",
      exportNotes: "Export my notes",
      cloudBackup: "Cloud backup",
      freeSpace: "Free up space",
      ai: "Artificial Intelligence",
      assistLevel: "AI assistance level",
      summaryLanguage: "Summary language",
      supportAccount: "Support and account",
      editProfile: "Edit profile",
      helpCenter: "Help center",
      logout: "Log out",
      summaryLanguageTitle: "Summary language",
      selected: "Selected",
    },
    languages: {
      es: "Spanish",
      en: "English",
      fr: "French",
      pt: "Portuguese",
      it: "Italian",
      de: "German",
    },
  },
  fr: {
    sidebar: {
      appName: "Digital Brain",
      factory: "Usine à idées",
      processed: "Traité",
      calendar: "Calendrier",
      settings: "Paramètres",
    },
    settings: {
      title: "Paramètres",
      darkMode: "Mode sombre",
      reviewSuggestions: "Suggestions de révision",
      dataPrivacy: "Données et confidentialité",
      exportNotes: "Exporter mes notes",
      cloudBackup: "Sauvegarde cloud",
      freeSpace: "Libérer de l'espace",
      ai: "Intelligence artificielle",
      assistLevel: "Niveau d'assistance IA",
      summaryLanguage: "Langue des résumés",
      supportAccount: "Support et compte",
      editProfile: "Modifier le profil",
      helpCenter: "Centre d'aide",
      logout: "Déconnexion",
      summaryLanguageTitle: "Langue des résumés",
      selected: "Sélectionné",
    },
    languages: {
      es: "Espagnol",
      en: "Anglais",
      fr: "Français",
      pt: "Portugais",
      it: "Italien",
      de: "Allemand",
    },
  },
  pt: {
    sidebar: {
      appName: "Digital Brain",
      factory: "Fábrica de ideias",
      processed: "Processado",
      calendar: "Calendário",
      settings: "Definições",
    },
    settings: {
      title: "Definições",
      darkMode: "Modo escuro",
      reviewSuggestions: "Sugestões de revisão",
      dataPrivacy: "Dados e privacidade",
      exportNotes: "Exportar as minhas notas",
      cloudBackup: "Cópia de segurança na nuvem",
      freeSpace: "Liberar espaço",
      ai: "Inteligência artificial",
      assistLevel: "Nível de assistência da IA",
      summaryLanguage: "Idioma dos resumos",
      supportAccount: "Suporte e conta",
      editProfile: "Editar perfil",
      helpCenter: "Centro de ajuda",
      logout: "Terminar sessão",
      summaryLanguageTitle: "Idioma dos resumos",
      selected: "Selecionado",
    },
    languages: {
      es: "Espanhol",
      en: "Inglês",
      fr: "Francês",
      pt: "Português",
      it: "Italiano",
      de: "Alemão",
    },
  },
  it: {
    sidebar: {
      appName: "Digital Brain",
      factory: "Fabbrica di idee",
      processed: "Elaborato",
      calendar: "Calendario",
      settings: "Impostazioni",
    },
    settings: {
      title: "Impostazioni",
      darkMode: "Modalità scura",
      reviewSuggestions: "Suggerimenti di revisione",
      dataPrivacy: "Dati e privacy",
      exportNotes: "Esporta le mie note",
      cloudBackup: "Backup cloud",
      freeSpace: "Libera spazio",
      ai: "Intelligenza artificiale",
      assistLevel: "Livello di assistenza IA",
      summaryLanguage: "Lingua dei riepiloghi",
      supportAccount: "Supporto e account",
      editProfile: "Modifica profilo",
      helpCenter: "Centro assistenza",
      logout: "Esci",
      summaryLanguageTitle: "Lingua dei riepiloghi",
      selected: "Selezionato",
    },
    languages: {
      es: "Spagnolo",
      en: "Inglese",
      fr: "Francese",
      pt: "Portoghese",
      it: "Italiano",
      de: "Tedesco",
    },
  },
  de: {
    sidebar: {
      appName: "Digital Brain",
      factory: "Ideenwerkstatt",
      processed: "Verarbeitet",
      calendar: "Kalender",
      settings: "Einstellungen",
    },
    settings: {
      title: "Einstellungen",
      darkMode: "Dunkelmodus",
      reviewSuggestions: "Überarbeitungsvorschläge",
      dataPrivacy: "Daten und Datenschutz",
      exportNotes: "Notizen exportieren",
      cloudBackup: "Cloud-Sicherung",
      freeSpace: "Speicher freigeben",
      ai: "Künstliche Intelligenz",
      assistLevel: "KI-Assistenzstufe",
      summaryLanguage: "Sprache der Zusammenfassungen",
      supportAccount: "Support und Konto",
      editProfile: "Profil bearbeiten",
      helpCenter: "Hilfezentrum",
      logout: "Abmelden",
      summaryLanguageTitle: "Sprache der Zusammenfassungen",
      selected: "Ausgewählt",
    },
    languages: {
      es: "Spanisch",
      en: "Englisch",
      fr: "Französisch",
      pt: "Portugiesisch",
      it: "Italienisch",
      de: "Deutsch",
    },
  },
};

const FALLBACK_LOCALE = "es";
const SUPPORTED = ["es", "en", "fr", "pt", "it", "de"];

/**
 * Normaliza código de idioma (ej. en-US -> en).
 */
export function normalizeLocale(code) {
  if (!code || typeof code !== "string") return FALLBACK_LOCALE;
  const base = code.split("-")[0].toLowerCase();
  return SUPPORTED.includes(base) ? base : FALLBACK_LOCALE;
}

/**
 * Detecta idioma del sistema/dispositivo. Mobile-first.
 */
export function getSystemLocale() {
  if (typeof navigator === "undefined") return FALLBACK_LOCALE;
  const lang = navigator.language || navigator.userLanguage || navigator.browserLanguage;
  if (lang) return normalizeLocale(lang);
  if (Array.isArray(navigator.languages) && navigator.languages[0])
    return normalizeLocale(navigator.languages[0]);
  return FALLBACK_LOCALE;
}

/**
 * Traduce una clave anidada (ej. "sidebar.factory").
 */
export function t(locale, key) {
  const dict = translations[locale] ?? translations[FALLBACK_LOCALE];
  const parts = key.split(".");
  let value = dict;
  for (const p of parts) {
    value = value?.[p];
  }
  return typeof value === "string" ? value : key;
}
